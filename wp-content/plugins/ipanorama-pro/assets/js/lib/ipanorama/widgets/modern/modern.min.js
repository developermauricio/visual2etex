!function(e,n){(function(_){"use strict";var j=jQuery,Q={name:"modern",defaultConfig:{titleControl:!0,prevSceneControl:!0,nextSceneControl:!0,audioControl:!0,compassControl:!0,fullscreenControl:!0,thumbnailControl:!0,viewerModeControl:!1,moveToNextScene:!0},widget:function(a,i){i=_.Utils.extend(Q.defaultConfig,i),this.audioPlayer=new _.AudioPlayer(a.config.audio);var r=this,o=a.$container,s=j("<div>").addClass("ipnrm-placeholder").css({display:"none"}),t={},c=null,l=null,d=null,m=null,p=[],f=null,u=!1,$=null;this.init=function(){e(),n()},this.setAudio=function(e){if(t.$audioPlayer.toggleClass("ipnrm-active",0<a.config.audio.tracks.length&&a.config.audio.enabled),a.config.audio.enabled)for(var n=0;n<a.config.audio.tracks.length;n++){var s=a.config.audio.tracks[n];if(s.sceneId==e.cfg.id){r.audioPlayer.setTrack(s.id),s.autoplay&&r.audioPlayer.play(),r.audioPlayer.loop(s.loop);break}}},this.setCompass=function(e){o.off("ipanorama:scene-camera-change",I),e.cfg.compass&&e.cfg.compass.enabled&&"flat"!=e.cfg.type&&"littleplanet"!=e.cfg.type?(o.on("ipanorama:scene-camera-change",I),t.$compass.toggleClass("ipnrm-active",e.cfg.compass.enabled),g(e)):t.$compass.toggleClass("ipnrm-active",!1)},this.destroy=function(){h(),t.$widget.remove(),t={},o.removeClass("ipnrm-widget-modern"),r.audioPlayer.destroy()};var g=function(e){if(e.control){var n=e.control.getLookAt().yaw,s=e.cfg.compass.northOffset-n;s=(s%=360)<0?s+360:s,t.$compass.css({transform:"rotate("+s+"deg)"})}},e=function(){o.addClass("ipnrm-widget-modern"),t.$widget=j("<div>").addClass("ipnrm-widget"),t.$firstLoad=j("<div>").addClass("ipnrm-first-load"),t.$ts=j("<div>").addClass("ipnrm-ts"),t.$bs=j("<div>").addClass("ipnrm-bs"),t.$tlBar=j("<div>").addClass("ipnrm-tl-bar"),t.$trBar=j("<div>").addClass("ipnrm-tr-bar"),t.$brBar=j("<div>").addClass("ipnrm-br-bar"),t.$blBar=j("<div>").addClass("ipnrm-bl-bar"),t.$progress=j("<div>").addClass("ipnrm-progress"),t.$progressBar=j("<div>").addClass("ipnrm-progress-bar").appendTo(t.$progress),t.$audioPlayer=r.audioPlayer.getWidget(),t.$prevScene=j("<div>").addClass("ipnrm-btn ipnrm-prev-scene"),t.$nextScene=j("<div>").addClass("ipnrm-btn ipnrm-next-scene"),t.$stereoMode=j("<div>").addClass("ipnrm-btn ipnrm-stereo-mode"),t.$thumbs=j("<div>").addClass("ipnrm-btn ipnrm-thumbs"),t.$compass=j("<div>").addClass("ipnrm-btn ipnrm-compass"),t.$fullscreen=j("<div>").addClass("ipnrm-btn ipnrm-fullscreen"),t.$title=j("<div>").addClass("ipnrm-title"),t.$ts.append(t.$tlBar,t.$trBar),t.$bs.append(t.$blBar,t.$brBar),t.$tlBar.append(t.$audioPlayer),t.$trBar.append(t.$prevScene,t.$nextScene),t.$brBar.append(t.$stereoMode,t.$thumbs,t.$compass,t.$fullscreen),t.$blBar.append(t.$title),t.$thumbsWrap=j("<div>").addClass("ipnrm-thumbs-wrap"),t.$thumbsList=j("<div>").addClass("ipnrm-thumbs-list"),t.$thumbsClose=j("<div>").addClass("ipnrm-thumbs-close"),t.$thumbsWrap.append(t.$thumbsList,t.$thumbsClose),t.$widget.append(t.$progress,t.$firstLoad,t.$ts,t.$bs,t.$thumbsWrap),o.append(t.$widget),v(),o.on("ipanorama:config",B).trigger("ipanorama:config")},n=function(){o.on("ipanorama:ready",O),o.on("fullscreenchange mozfullscreenchange webkitfullscreenchange msfullscreenchange",H),o.on("ipanorama:scene-before-load",T),o.on("ipanorama:scene-after-load",W),o.on("ipanorama:scene-progress",P),o.on("ipanorama:scene-error",A),o.on("ipanorama:scene-hide-start",z),o.on("ipanorama:scene-hide-complete",R),o.on("ipanorama:scene-show-start",q),o.on("ipanorama:scene-show-complete",E),o.on("ipanorama:scene-index",N),o.on("ipanorama:mode",M),t.$prevScene.on("click",C),t.$nextScene.on("click",b),t.$stereoMode.on("click",k),t.$compass.on("click",x),t.$fullscreen.on("click",L),t.$thumbs.on("click",w),t.$thumbsList.on("click",".ipnrm-thumb",y),t.$thumbsClose.on("click",S),t.$firstLoad.on("click",F)},h=function(){o.off("ipanorama:ready",O),o.off("fullscreenchange mozfullscreenchange webkitfullscreenchange msfullscreenchange",H),o.off("ipanorama:scene-before-load",T),o.off("ipanorama:scene-after-load",W),o.off("ipanorama:scene-progress",P),o.off("ipanorama:scene-error",A),o.off("ipanorama:scene-hide-start",z),o.off("ipanorama:scene-hide-complete",R),o.off("ipanorama:scene-show-start",q),o.off("ipanorama:scene-show-complete",E),o.off("ipanorama:scene-camera-change",I),o.off("ipanorama:scene-index",N),o.off("ipanorama:mode",M),t.$prevScene.off("click",C),t.$nextScene.off("click",b),t.$stereoMode.off("click",k),t.$compass.off("click",x),t.$fullscreen.off("click",L),t.$thumbs.off("click",w),t.$thumbsList.off("click",".ipnrm-thumb",y),t.$thumbsClose.off("click",S),t.$firstLoad.off("click",F)},v=function(){t.$firstLoad.addClass("ipnrm-hide"),t.$title.addClass("ipnrm-hide"),t.$audioPlayer.addClass("ipnrm-hide"),t.$compass.addClass("ipnrm-hide"),t.$prevScene.addClass("ipnrm-hide"),t.$nextScene.addClass("ipnrm-hide"),t.$fullscreen.addClass("ipnrm-hide"),t.$thumbs.addClass("ipnrm-hide"),t.$stereoMode.addClass("ipnrm-hide"),t.$thumbsWrap.addClass("ipnrm-hide")},C=function(e){(f-=1)<0?f=null:o.trigger("ipanorama:set-scene",{id:p[f]})},b=function(e){(f+=1)>=p.length?(f=p.length-1,o.trigger("ipanorama:next-scene")):o.trigger("ipanorama:set-scene",{id:p[f]})},k=function(e){var n=c;switch(n){case"normal":n="stereo";break;case"stereo":n="normal"}o.trigger("ipanorama:mode",{mode:n})},w=function(e){var n=t.$thumbsList.find(".ipnrm-thumb.ipnrm-active");n.removeClass("ipnrm-active"),(n=t.$thumbsList.find('[data-scene-id="'+l+'"]')).addClass("ipnrm-active"),t.$thumbsWrap.addClass("ipnrm-active"),setTimeout(function(){if(t.$thumbsList.find(".ipnrm-thumb").length){var e=t.$thumbsList.find(".ipnrm-thumb:first-child").get(0).offsetTop;t.$thumbsList.get(0).scrollTop=n.get(0).offsetTop-e}},100)},y=function(e){o.trigger("ipanorama:set-scene",{id:j(this).data("scene-id")}),t.$thumbsWrap.removeClass("ipnrm-active")},S=function(e){t.$thumbsWrap.removeClass("ipnrm-active")},x=function(e){if(d){var n=d.control.getLookAt();d.control.lookAt({yaw:d.cfg.compass.northOffset,pitch:n.pitch},600)}},L=function(e){if(document.fullscreenEnabled||document.webkitFullscreenEnabled)if(t.$fullscreen.hasClass("ipnrm-active"))try{document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()}catch(e){}else try{var n=o.get(0);n.requestFullscreen?n.requestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.webkitRequestFullscreen?n.webkitRequestFullscreen():n.msRequestFullscreen&&n.msRequestFullscreen()}catch(e){}else o.toggleClass("ipnrm-fullscreen-mode"),o.hasClass("ipnrm-fullscreen-mode")?(t.$fullscreen.addClass("ipnrm-active"),s.insertBefore(o),o.detach(),j("body").append(o)):(t.$fullscreen.removeClass("ipnrm-active"),o.detach(),o.insertAfter(s),s.remove()),$._onWindowResize()},F=function(e){m&&(t.$firstLoad.addClass("ipnrm-hide"),o.trigger("ipanorama:set-scene",{id:m}))},B=function(e,n){if(n&&n.config){if(o.off("ipanorama:config",B),!n.config.autoLoad&&0<n.config.scenes.length){t.$firstLoad.removeClass("ipnrm-hide");var s=n.config.scenes[0],a=o.data("scene-id");if(a)for(var i=0;i<n.config.scenes.length;i++)if(n.config.scenes[i].id===a){s=n.config.scenes[i];break}m=s.id}!function(e){for(var n=0;n<e.scenes.length;n++){var s=e.scenes[n];if(s.image||s.imageThumb){var a=j("<div>").addClass("ipnrm-thumb").attr({"data-scene-id":s.id}),i=j("<img>").attr({loading:"lazy",src:s.imageThumb?s.imageThumb:"string"==typeof s.image?s.image:""});t.$thumbsList.append(a.append(i))}}}(n.config)}},M=function(e,n){if(n&&n.master)switch(c=n.mode){case"normal":t.$stereoMode.removeClass("ipnrm-active");break;case"stereo":t.$stereoMode.addClass("ipnrm-active")}},P=function(e,n){n.progress.loaded<n.progress.total?(u||(t.$progress.addClass("ipnrm-active"),u=!0),t.$progressBar.css({width:n.progress.loaded/n.progress.total*100+"%"})):(u&&(t.$progress.removeClass("ipnrm-active"),u=!1),t.$progressBar.css({width:0}))},T=function(e,n){d=n.scene},W=function(e,n){t.$progress.removeClass("ipnrm-active"),u=!1,t.$firstLoad.addClass("ipnrm-hide"),i.titleControl&&t.$title.removeClass("ipnrm-hide"),i.audioControl&&t.$audioPlayer.removeClass("ipnrm-hide"),i.compassControl&&t.$compass.removeClass("ipnrm-hide"),i.prevSceneControl&&t.$prevScene.removeClass("ipnrm-hide"),i.nextSceneControl&&t.$nextScene.removeClass("ipnrm-hide"),i.fullscreenControl&&t.$fullscreen.removeClass("ipnrm-hide"),i.thumbnailControl&&t.$thumbs.removeClass("ipnrm-hide"),i.viewerModeControl&&t.$stereoMode.removeClass("ipnrm-hide"),t.$thumbsWrap.removeClass("ipnrm-hide")},A=function(e,n){t.$progress.removeClass("ipnrm-active"),u=!1,v()},z=function(e,n){},R=function(e,n){},q=function(e,n){r.setAudio(n.scene),r.setCompass(n.scene),n.scene.cfg.title?(t.$title.get(0).innerHTML=n.scene.cfg.title,t.$title.addClass("ipnrm-active")):(t.$title.get(0).innerHTML=null,t.$title.removeClass("ipnrm-active"))},E=function(e,n){},I=function(e,n){n.scene&&g(n.scene)},N=function(e,n){if(n)if(l=n.scene.cfg.id,null==f?(p.push(l),f=0):p[f]!=l&&(f+=1,(p=p.slice(0,f)).push(l)),0<f?t.$prevScene.addClass("ipnrm-active"):t.$prevScene.removeClass("ipnrm-active"),f<p.length-1)t.$nextScene.addClass("ipnrm-active");else if(t.$nextScene.removeClass("ipnrm-active"),i.moveToNextScene){for(var s=0;s<n.config.scenes.length;s++){var a=n.config.scenes[s];if(a.id==l)break}s<n.config.scenes.length-1&&t.$nextScene.addClass("ipnrm-active")}},O=function(e,n){$=n.instance},H=function(e){document.fullscreen||document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement?t.$fullscreen.addClass("ipnrm-active"):t.$fullscreen.removeClass("ipnrm-active"),setTimeout(function(){$._onWindowResize()},100)}}};_.Widget=_.Widget||{},_.Widget.Modern=Q})((e=e||self).IPANORAMA=e.IPANORAMA||{})}(this);