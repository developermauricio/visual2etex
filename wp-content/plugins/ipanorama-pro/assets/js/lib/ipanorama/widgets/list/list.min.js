!function(e,n){(function(I){"use strict";var M=jQuery,N={name:"list",defaultConfig:{titleControl:!0,prevSceneControl:!0,nextSceneControl:!0,audioControl:!0,compassControl:!0,fullscreenControl:!0,sceneListControl:!0,moveToNextScene:!0},widget:function(i,a){a=I.Utils.extend(N.defaultConfig,a),this.audioPlayer=new I.AudioPlayer(i.config.audio);var t=this,c=i.$container,s=M("<div>").addClass("ipnrm-placeholder").css({display:"none"}),o={},r=null,l=null,d=null,m=[],f=null,p=!1,u=null;this.init=function(){e(),n()},this.setAudio=function(e){if(o.$audioPlayer.toggleClass("ipnrm-active",0<i.config.audio.tracks.length&&i.config.audio.enabled),i.config.audio.enabled)for(var n=0;n<i.config.audio.tracks.length;n++){var s=i.config.audio.tracks[n];if(s.sceneId==e.cfg.id){t.audioPlayer.setTrack(s.id),s.autoplay&&t.audioPlayer.play(),t.audioPlayer.loop(s.loop);break}}},this.setCompass=function(e){c.off("ipanorama:scene-camera-change",H),e.cfg.compass&&e.cfg.compass.enabled&&"flat"!=e.cfg.type&&"littleplanet"!=e.cfg.type?(c.on("ipanorama:scene-camera-change",H),o.$compass.toggleClass("ipnrm-active",e.cfg.compass.enabled),g(e)):o.$compass.toggleClass("ipnrm-active",!1)},this.destroy=function(){v(),o.$widget.remove(),o={},c.removeClass("ipnrm-widget-list"),t.audioPlayer.destroy()};var g=function(e){if(e.control){var n=e.control.getLookAt().yaw,s=e.cfg.compass.northOffset-n;s=(s%=360)<0?s+360:s,o.$compass.css({transform:"rotate("+s+"deg)"})}},e=function(){c.addClass("ipnrm-widget-list"),o.$widget=M("<div>").addClass("ipnrm-widget"),o.$firstLoad=M("<div>").addClass("ipnrm-first-load"),o.$progress=M("<div>").addClass("ipnrm-progress"),o.$navigation=M("<div>").addClass("ipnrm-navigation"),o.$prevScene=M("<div>").addClass("ipnrm-btn ipnrm-prev-scene"),o.$nextScene=M("<div>").addClass("ipnrm-btn ipnrm-next-scene"),o.$sceneListHead=M("<div>").addClass("ipnrm-scene-list-head"),o.$sceneListData=M("<div>").addClass("ipnrm-scene-list-data"),o.$sceneList=M("<div>").addClass("ipnrm-btn ipnrm-scene-list").append("<div><div></div><div></div><div></div></div>"),o.$audioPlayer=t.audioPlayer.getWidget(),o.$title=M("<div>").addClass("ipnrm-title"),o.$tools=M("<div>").addClass("ipnrm-tools"),o.$compass=M("<div>").addClass("ipnrm-btn ipnrm-compass"),o.$fullscreen=M("<div>").addClass("ipnrm-btn ipnrm-fullscreen"),o.$navigation.append(o.$prevScene,o.$nextScene),o.$tools.append(o.$compass,o.$fullscreen),o.$widget.append(o.$progress,o.$firstLoad,o.$navigation,o.$sceneListHead,o.$sceneListData,o.$sceneList,o.$audioPlayer,o.$title,o.$tools),c.append(o.$widget),$(),c.on("ipanorama:config",w).trigger("ipanorama:config")},n=function(){c.on("ipanorama:ready",T),c.on("fullscreenchange mozfullscreenchange webkitfullscreenchange msfullscreenchange",W),c.on("ipanorama:scene-before-load",F),c.on("ipanorama:scene-after-load",P),c.on("ipanorama:scene-progress",x),c.on("ipanorama:scene-error",A),c.on("ipanorama:scene-hide-start",D),c.on("ipanorama:scene-hide-complete",R),c.on("ipanorama:scene-show-start",z),c.on("ipanorama:scene-show-complete",q),c.on("ipanorama:scene-index",E),o.$firstLoad.on("click",b),o.$prevScene.on("click",C),o.$nextScene.on("click",h),o.$sceneList.on("click",L),o.$sceneListData.on("click",".ipnrm-scene-list-item",k),o.$compass.on("click",S),o.$fullscreen.on("click",y)},v=function(){c.off("ipanorama:ready",T),c.off("fullscreenchange mozfullscreenchange webkitfullscreenchange msfullscreenchange",W),c.off("ipanorama:scene-before-load",F),c.off("ipanorama:scene-after-load",P),c.off("ipanorama:scene-progress",x),c.off("ipanorama:scene-error",A),c.off("ipanorama:scene-hide-start",D),c.off("ipanorama:scene-hide-complete",R),c.off("ipanorama:scene-show-start",z),c.off("ipanorama:scene-show-complete",q),c.off("ipanorama:scene-camera-change",H),c.off("ipanorama:scene-index",E),o.$firstLoad.off("click",b),o.$prevScene.off("click",C),o.$nextScene.off("click",h),o.$sceneList.off("click",L),o.$sceneListData.off("click",k),o.$compass.off("click",S),o.$fullscreen.off("click",y)},$=function(){o.$firstLoad.addClass("ipnrm-hide"),o.$prevScene.addClass("ipnrm-hide"),o.$nextScene.addClass("ipnrm-hide"),o.$compass.addClass("ipnrm-hide"),o.$sceneList.addClass("ipnrm-hide"),o.$sceneListHead.addClass("ipnrm-hide"),o.$sceneListData.addClass("ipnrm-hide"),o.$audioPlayer.addClass("ipnrm-hide"),o.$title.addClass("ipnrm-hide"),o.$fullscreen.addClass("ipnrm-hide")},C=function(e){(f-=1)<0?f=null:c.trigger("ipanorama:set-scene",{id:m[f]})},h=function(e){(f+=1)>=m.length?(f=m.length-1,c.trigger("ipanorama:next-scene")):c.trigger("ipanorama:set-scene",{id:m[f]})},L=function(e){o.$sceneList.hasClass("ipnrm-active")?(o.$sceneListHead.css({transition:"all .2s linear .2s"}),o.$sceneListData.css({transition:"all .2s linear"})):(o.$sceneListHead.css({transition:"all .2s linear"}),o.$sceneListData.css({transition:"all .2s linear .2s"})),o.$sceneList.toggleClass("ipnrm-active"),o.$sceneListHead.toggleClass("ipnrm-active"),o.$sceneListData.toggleClass("ipnrm-active")},k=function(e){var n=M(this);r=n.data("scene-id"),c.trigger("ipanorama:set-scene",{id:r})},S=function(e){if(l){var n=l.control.getLookAt();l.control.lookAt({yaw:l.cfg.compass.northOffset,pitch:n.pitch},600)}},y=function(e){if(document.fullscreenEnabled||document.webkitFullscreenEnabled)if(o.$fullscreen.hasClass("ipnrm-active"))try{document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()}catch(e){}else try{var n=c.get(0);n.requestFullscreen?n.requestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.webkitRequestFullscreen?n.webkitRequestFullscreen():n.msRequestFullscreen&&n.msRequestFullscreen()}catch(e){}else c.toggleClass("ipnrm-fullscreen-mode"),c.hasClass("ipnrm-fullscreen-mode")?(o.$fullscreen.addClass("ipnrm-active"),s.insertBefore(c),c.detach(),M("body").append(c)):(o.$fullscreen.removeClass("ipnrm-active"),c.detach(),c.insertAfter(s),s.remove()),u._onWindowResize()},b=function(e){d&&(o.$firstLoad.addClass("ipnrm-hide"),c.trigger("ipanorama:set-scene",{id:d}))},w=function(e,n){if(n&&n.config){if(c.off("ipanorama:config",w),!n.config.autoLoad&&0<n.config.scenes.length){o.$firstLoad.removeClass("ipnrm-hide");var s=n.config.scenes[0],i=c.data("scene-id");if(i)for(var a=0;a<n.config.scenes.length;a++)if(n.config.scenes[a].id===i){s=n.config.scenes[a];break}d=s.id}!function(e){for(var n=0;n<e.scenes.length;n++){var s=e.scenes[n];if(s.title){var i=M("<div>").addClass("ipnrm-scene-list-item").attr({"data-scene-id":s.id}).html(s.title);o.$sceneListData.append(i)}}}(n.config)}},x=function(e,n){n.progress.loaded<n.progress.total?p||(o.$progress.addClass("ipnrm-active"),p=!0):p&&(o.$progress.removeClass("ipnrm-active"),p=!1)},F=function(e,n){l=n.scene},P=function(e,n){o.$progress.removeClass("ipnrm-active"),p=!1;var s=n.scene.cfg.id;o.$sceneListData.find(".ipnrm-scene-list-item").removeClass("ipnrm-active"),o.$sceneListData.find('.ipnrm-scene-list-item[data-scene-id="'+s+'"]').addClass("ipnrm-active"),o.$firstLoad.addClass("ipnrm-hide"),a.prevSceneControl&&o.$prevScene.removeClass("ipnrm-hide"),a.nextSceneControl&&o.$nextScene.removeClass("ipnrm-hide"),a.compassControl&&o.$compass.removeClass("ipnrm-hide"),a.sceneListControl&&o.$sceneList.removeClass("ipnrm-hide"),a.sceneListControl&&o.$sceneListHead.removeClass("ipnrm-hide"),a.sceneListControl&&o.$sceneListData.removeClass("ipnrm-hide"),a.audioControl&&o.$audioPlayer.removeClass("ipnrm-hide"),a.titleControl&&o.$title.removeClass("ipnrm-hide"),a.fullscreenControl&&o.$fullscreen.removeClass("ipnrm-hide")},A=function(e,n){o.$progress.removeClass("ipnrm-active"),p=!1,$()},D=function(e,n){},R=function(e,n){},z=function(e,n){t.setAudio(n.scene),t.setCompass(n.scene),n.scene.cfg.title?(o.$title.get(0).innerHTML=n.scene.cfg.title,o.$title.addClass("ipnrm-active")):(o.$title.get(0).innerHTML=null,o.$title.removeClass("ipnrm-active"))},H=function(e,n){n.scene&&g(n.scene)},q=function(e,n){},E=function(e,n){if(n)if(r=n.scene.cfg.id,null==f?(m.push(r),f=0):m[f]!=r&&(f+=1,(m=m.slice(0,f)).push(r)),0<f?o.$prevScene.addClass("ipnrm-active"):o.$prevScene.removeClass("ipnrm-active"),f<m.length-1)o.$nextScene.addClass("ipnrm-active");else if(o.$nextScene.removeClass("ipnrm-active"),a.moveToNextScene){for(var s=0;s<n.config.scenes.length;s++){var i=n.config.scenes[s];if(i.id==r)break}s<n.config.scenes.length-1&&o.$nextScene.addClass("ipnrm-active")}},T=function(e,n){u=n.instance},W=function(e){document.fullscreen||document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement?o.$fullscreen.addClass("ipnrm-active"):o.$fullscreen.removeClass("ipnrm-active"),setTimeout(function(){u._onWindowResize()},100)}}};I.Widget=I.Widget||{},I.Widget.List=N})((e=e||self).IPANORAMA=e.IPANORAMA||{})}(this);