!function(e,o){(function(J){"use strict";var K=jQuery,V={name:"civic",defaultConfig:{audioControl:!0,compassControl:!0,titleThumbnails:!0,thumbnailsControl:!0,prevSceneControl:!0,nextSceneControl:!0,zoomInControl:!0,zoomOutControl:!0,lookUpControl:!0,lookDownControl:!0,lookLeftControl:!0,lookRightControl:!0,homeControl:!1,fullscreenControl:!0,viewerModeControl:!1,toogleInterfaceControl:!0,startFullscreen:!1,hideInterface:!1},widget:function(t,r){r=J.Utils.extend(V.defaultConfig,r),this.audioPlayer=new J.AudioPlayer(t.config.audio);var i=this,s=t.$container,n=K("<div>").addClass("ipnrm-placeholder").css({display:"none"}),a={},c=null,l=null,d=null,m=!1,o=null,f=null;this.init=function(){e(),p()},this.setAudio=function(e){if(a.$audioPlayer.toggleClass("ipnrm-active",0<t.config.audio.tracks.length&&t.config.audio.enabled),t.config.audio.enabled)for(var o=0;o<t.config.audio.tracks.length;o++){var n=t.config.audio.tracks[o];if(n.sceneId==e.cfg.id){i.audioPlayer.setTrack(n.id),n.autoplay&&i.audioPlayer.play(),i.audioPlayer.loop(n.loop);break}}},this.setCompass=function(e){s.off("ipanorama:scene-camera-change",F),e.cfg.compass&&e.cfg.compass.enabled&&"flat"!=e.cfg.type&&"littleplanet"!=e.cfg.type?(s.on("ipanorama:scene-camera-change",F),a.$compass.toggleClass("ipnrm-active",e.cfg.compass.enabled),u(e)):a.$compass.toggleClass("ipnrm-active",!1)},this.destroy=function(){g(),a.$widget.remove(),a={},s.removeClass("ipnrm-widget-civic"),i.audioPlayer.destroy()};var u=function(e){if(e.control){var o=e.control.getLookAt().yaw,n=e.cfg.compass.northOffset-o;n=(n%=360)<0?n+360:n,a.$compass.css({transform:"rotate("+n+"deg)"})}},e=function(){s.addClass("ipnrm-widget-civic"),a.$widget=K("<div>").addClass("ipnrm-widget"),a.$firstLoad=K("<div>").addClass("ipnrm-first-load"),a.$progress=K("<div>").addClass("ipnrm-progress"),a.$progressBar=K("<div>").addClass("ipnrm-progress-bar").appendTo(a.$progress),a.$interface=K("<div>").addClass("ipnrm-interface"),a.$audioPlayer=i.audioPlayer.getWidget(),a.$compass=K("<div>").addClass("ipnrm-compass"),a.$thumbsBar=K("<div>").addClass("ipnrm-thumbs-bar"),a.$menuBar=K("<div>").addClass("ipnrm-menu-bar"),a.$interface.append(a.$thumbsBar,a.$menuBar),a.$prevScene=K("<div>").addClass("ipnrm-btn ipnrm-prev-scene"),a.$nextScene=K("<div>").addClass("ipnrm-btn ipnrm-next-scene"),a.$zoomIn=K("<div>").addClass("ipnrm-btn ipnrm-zoom-in"),a.$zoomOut=K("<div>").addClass("ipnrm-btn ipnrm-zoom-out"),a.$lookUp=K("<div>").addClass("ipnrm-btn ipnrm-look-up"),a.$lookDown=K("<div>").addClass("ipnrm-btn ipnrm-look-down"),a.$lookLeft=K("<div>").addClass("ipnrm-btn ipnrm-look-left"),a.$lookRight=K("<div>").addClass("ipnrm-btn ipnrm-look-right"),a.$home=K("<div>").addClass("ipnrm-btn ipnrm-home"),a.$fullscreen=K("<div>").addClass("ipnrm-btn ipnrm-fullscreen"),a.$stereoMode=K("<div>").addClass("ipnrm-btn ipnrm-stereo-mode"),a.$toggleInterface=K("<div>").addClass("ipnrm-btn ipnrm-toggle-interface"),a.$menuBar.append(a.$prevScene,a.$nextScene,a.$zoomIn,a.$zoomOut,a.$lookUp,a.$lookDown,a.$lookLeft,a.$lookRight,a.$home,a.$fullscreen,a.$stereoMode,a.$toggleInterface),a.$widget.append(a.$progress,a.$firstLoad,a.$audioPlayer,a.$compass,a.$interface),s.append(a.$widget),r.startFullscreen&&s.addClass("ipnrm-fullscreen"),r.hideInterface&&a.$widget.addClass("ipnrm-hide-controls"),v(),s.on("ipanorama:config",T).trigger("ipanorama:config")},p=function(){s.on("ipanorama:ready",S),s.on("mouseup touchend",M),s.on("fullscreenchange mozfullscreenchange webkitfullscreenchange msfullscreenchange",H),s.on("ipanorama:scene-before-load",A),s.on("ipanorama:scene-after-load",z),s.on("ipanorama:scene-progress",y),s.on("ipanorama:scene-error",I),s.on("ipanorama:scene-show-start",L),s.on("ipanorama:mode",B),a.$thumbsBar.on("click",".ipnrm-thumb",R),a.$firstLoad.on("click",x),a.$prevScene.on("click",P),a.$nextScene.on("click",U),a.$zoomIn.on("mousedown touchstart",O),a.$zoomOut.on("mousedown touchstart",q),a.$lookUp.on("mousedown touchstart",D),a.$lookDown.on("mousedown touchstart",E),a.$lookLeft.on("mousedown touchstart",W),a.$lookRight.on("mousedown touchstart",Z),a.$home.on("click",N),a.$fullscreen.on("click",_),a.$stereoMode.on("click",j),a.$compass.on("click",G),a.$toggleInterface.on("click",Q)},g=function(){s.off("ipanorama:ready",S),s.off("mouseup  touchend",M),s.off("fullscreenchange mozfullscreenchange webkitfullscreenchange msfullscreenchange",H),s.off("ipanorama:scene-before-load",A),s.off("ipanorama:scene-after-load",z),s.off("ipanorama:scene-progress",y),s.off("ipanorama:scene-error",I),s.off("ipanorama:scene-show-start",L),s.off("ipanorama:scene-camera-change",F),s.off("ipanorama:mode",B),a.$thumbsBar.off("click",".ipnrm-thumb",R),a.$firstLoad.off("click",x),a.$prevScene.off("click",P),a.$nextScene.off("click",U),a.$zoomIn.off("mousedown touchstart",O),a.$zoomOut.off("mousedown touchstart",q),a.$lookUp.off("mousedown touchstart",D),a.$lookDown.off("mousedown touchstart",E),a.$lookLeft.off("mousedown touchstart",W),a.$lookRight.off("mousedown touchstart",Z),a.$home.off("click",N),a.$fullscreen.off("click",_),a.$stereoMode.off("click",j),a.$compass.off("click",G),a.$toggleInterface.off("click",Q)},v=function(){a.$firstLoad.addClass("ipnrm-hide"),a.$audioPlayer.addClass("ipnrm-hide"),a.$compass.addClass("ipnrm-hide"),a.$thumbsBar.addClass("ipnrm-hide"),a.$prevScene.addClass("ipnrm-hide"),a.$nextScene.addClass("ipnrm-hide"),a.$zoomIn.addClass("ipnrm-hide"),a.$zoomOut.addClass("ipnrm-hide"),a.$lookUp.addClass("ipnrm-hide"),a.$lookDown.addClass("ipnrm-hide"),a.$lookLeft.addClass("ipnrm-hide"),a.$lookRight.addClass("ipnrm-hide"),a.$home.addClass("ipnrm-hide"),a.$fullscreen.addClass("ipnrm-hide"),a.$stereoMode.addClass("ipnrm-hide"),a.$toggleInterface.addClass("ipnrm-hide")},h=function(){o=setTimeout(function(){var e=f.viewer.sceneActive.control,o=e.getZoom();"flat"==f.viewer.sceneActive.cfg.type?o+=.01:"littleplanet"==f.viewer.sceneActive.cfg.type?o-=50:o-=.2,e.setZoom(o),h()},10)},$=function(){o=setTimeout(function(){var e=f.viewer.sceneActive.control,o=e.getZoom();"flat"==f.viewer.sceneActive.cfg.type?o-=.01:"littleplanet"==f.viewer.sceneActive.cfg.type?o+=50:o+=.2,e.setZoom(o),$()},10)},C=function(){o=setTimeout(function(){var e=f.viewer.sceneActive.control;"flat"==f.viewer.sceneActive.cfg.type?e.rotateUp(5):e.rotateUp(.01),C()},10)},k=function(){o=setTimeout(function(){var e=f.viewer.sceneActive.control;"flat"==f.viewer.sceneActive.cfg.type?e.rotateUp(-5):e.rotateUp(-.01),k()},10)},w=function(){o=setTimeout(function(){var e=f.viewer.sceneActive.control;"flat"==f.viewer.sceneActive.cfg.type?e.rotateLeft(5):e.rotateLeft(.01),w()},10)},b=function(){o=setTimeout(function(){var e=f.viewer.sceneActive.control;"flat"==f.viewer.sceneActive.cfg.type?e.rotateLeft(-5):e.rotateLeft(-.01),b()},10)},y=function(e,o){o.progress.loaded<o.progress.total?(m||(a.$progress.addClass("ipnrm-active"),m=!0),a.$progressBar.css({width:o.progress.loaded/o.progress.total*100+"%"})):(m&&(a.$progress.removeClass("ipnrm-active"),m=!1),a.$progressBar.css({width:0}))},A=function(e,o){d=o.scene},z=function(e,o){a.$progress.removeClass("ipnrm-active"),m=!1;var n=a.$thumbsBar.find('.ipnrm-thumb[data-scene-id="'+o.scene.cfg.id+'"]');a.$thumbsBar.find(".ipnrm-thumb.ipnrm-active").removeClass("ipnrm-active"),n.addClass("ipnrm-active"),function(){a.$firstLoad.addClass("ipnrm-hide"),r.audioControl&&a.$audioPlayer.removeClass("ipnrm-hide"),r.compassControl&&a.$compass.removeClass("ipnrm-hide"),r.thumbnailsControl&&a.$thumbsBar.removeClass("ipnrm-hide"),r.prevSceneControl&&a.$prevScene.removeClass("ipnrm-hide"),r.nextSceneControl&&a.$nextScene.removeClass("ipnrm-hide"),r.zoomInControl&&a.$zoomIn.removeClass("ipnrm-hide"),r.zoomOutControl&&a.$zoomOut.removeClass("ipnrm-hide"),r.lookUpControl&&a.$lookUp.removeClass("ipnrm-hide"),r.lookDownControl&&a.$lookDown.removeClass("ipnrm-hide"),r.lookLeftControl&&a.$lookLeft.removeClass("ipnrm-hide"),r.lookRightControl&&a.$lookRight.removeClass("ipnrm-hide"),r.homeControl&&a.$home.removeClass("ipnrm-hide"),r.fullscreenControl&&a.$fullscreen.removeClass("ipnrm-hide"),r.viewerModeControl&&a.$stereoMode.removeClass("ipnrm-hide"),r.toogleInterfaceControl&&a.$toggleInterface.removeClass("ipnrm-hide"),s.hasClass("ipnrm-fullscreen")?a.$fullscreen.addClass("ipnrm-active"):a.$fullscreen.removeClass("ipnrm-active");a.$widget.hasClass("ipnrm-hide-controls")?a.$toggleInterface.removeClass("ipnrm-active"):a.$toggleInterface.addClass("ipnrm-active")}(),setTimeout(function(){if(a.$thumbs.find(".ipnrm-thumb").length){var e=a.$thumbs.find(".ipnrm-thumb:first-child").get(0).offsetLeft;n.get(0)&&(a.$thumbsBar.get(0).scrollLeft=n.get(0).offsetLeft-e)}},100)},I=function(e,o){a.$progress.removeClass("ipnrm-active"),m=!1,v()},L=function(e,o){i.setAudio(o.scene),i.setCompass(o.scene)},F=function(e,o){o.scene&&u(o.scene)},S=function(e,o){f=o.instance},T=function(e,o){if(o&&o.config){if(s.off("ipanorama:config",T),!o.config.autoLoad&&0<o.config.scenes.length){a.$firstLoad.removeClass("ipnrm-hide");var n=o.config.scenes[0],t=s.data("scene-id");if(t)for(var i=0;i<o.config.scenes.length;i++)if(o.config.scenes[i].id===t){n=o.config.scenes[i];break}l=n.id}!function(e){if(!e.scenes.length)return;a.$thumbs=K("<div>").addClass("ipnrm-thumbs"),a.$thumbsBar.append(a.$thumbs);for(var o=0;o<e.scenes.length;o++){var n=e.scenes[o],t=K("<div>").addClass("ipnrm-thumb").attr({"data-scene-id":n.id});if(r.titleThumbnails){if(n.title){var i=K("<div>").addClass("ipnrm-thumb-title").html(n.title);a.$thumbs.append(t.append(i))}}else if(n.image||n.imageThumb){var s=K("<img>").attr({loading:"lazy",src:n.imageThumb?n.imageThumb:n.image});a.$thumbs.append(t.append(s));var i=K("<div>").addClass("ipnrm-thumb-title-img").html(n.title);a.$thumbs.append(t.append(i))}}}(o.config)}},B=function(e,o){if(o&&o.master)switch(c=o.mode){case"normal":a.$stereoMode.removeClass("ipnrm-active");break;case"stereo":a.$stereoMode.addClass("ipnrm-active")}},R=function(e){s.trigger("ipanorama:set-scene",{id:K(this).data("scene-id")}),a.$thumbsBar.find(".ipnrm-thumb.ipnrm-active").removeClass("ipnrm-active"),K(this).addClass("ipnrm-active")},x=function(e){l&&(a.$firstLoad.addClass("ipnrm-hide"),s.trigger("ipanorama:set-scene",{id:l}))},P=function(e){if(f.viewer&&f.viewer.sceneActive){for(var o=f.viewer.sceneActive.cfg.id,n=0;n<f.config.scenes.length;n++){var t=f.config.scenes[n];if(t.id==o)break}n-1<0?n=f.config.scenes.length-1:n-=1,s.trigger("ipanorama:set-scene",{id:f.config.scenes[n].id})}},U=function(e){if(f.viewer&&f.viewer.sceneActive){for(var o=f.viewer.sceneActive.cfg.id,n=0;n<f.config.scenes.length;n++){var t=f.config.scenes[n];if(t.id==o)break}n+1>=f.config.scenes.length?n=0:n+=1,s.trigger("ipanorama:set-scene",{id:f.config.scenes[n].id})}},M=function(e){clearTimeout(o)},O=function(e){clearTimeout(o),h()},q=function(e){clearTimeout(o),$()},D=function(e){clearTimeout(o),C()},E=function(e){clearTimeout(o),k()},W=function(e){clearTimeout(o),w()},Z=function(e){clearTimeout(o),b()},N=function(e){var o=f.viewer.sceneActive.control;o.lookAt(f.viewer.sceneActive.cfg.camera.lookAt,500)},_=function(e){if(document.fullscreenEnabled||document.webkitFullscreenEnabled)if(a.$fullscreen.hasClass("ipnrm-active"))try{document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()}catch(e){}else try{var o=s.get(0);o.requestFullscreen?o.requestFullscreen():o.mozRequestFullScreen?o.mozRequestFullScreen():o.webkitRequestFullscreen?o.webkitRequestFullscreen():o.msRequestFullscreen&&o.msRequestFullscreen()}catch(e){}else s.toggleClass("ipnrm-fullscreen-mode"),s.hasClass("ipnrm-fullscreen-mode")?(a.$fullscreen.addClass("ipnrm-active"),n.insertBefore(s),s.detach(),K("body").append(s)):(a.$fullscreen.removeClass("ipnrm-active"),s.detach(),s.insertAfter(n),n.remove()),f._onWindowResize()},j=function(e){var o=c;switch(o){case"normal":o="stereo";break;case"stereo":o="normal"}s.trigger("ipanorama:mode",{mode:o})},Q=function(e){a.$widget.toggleClass("ipnrm-hide-controls"),a.$widget.hasClass("ipnrm-hide-controls")?a.$toggleInterface.removeClass("ipnrm-active"):a.$toggleInterface.addClass("ipnrm-active")},G=function(e){if(d){var o=d.control.getLookAt();d.control.lookAt({yaw:d.cfg.compass.northOffset,pitch:o.pitch},600)}},H=function(e){document.fullscreen||document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement?a.$fullscreen.addClass("ipnrm-active"):a.$fullscreen.removeClass("ipnrm-active"),setTimeout(function(){f._onWindowResize()},100)}}};J.Widget=J.Widget||{},J.Widget.Civic=V})((e=e||self).IPANORAMA=e.IPANORAMA||{})}(this);