!function(e,n){(function(G){"use strict";var e={name:"modern",defaultConfig:{titleControl:!0,prevSceneControl:!0,nextSceneControl:!0,audioControl:!0,compassControl:!0,fullscreenControl:!0,thumbnailControl:!0,viewerModeControl:!1,moveToNextScene:!0},widget:function(e,r,i,n){n&&(i=G.Utils.extend(n,i)),this.audioPlayer=new G.AudioPlayer;var s=this,o=G.$,t=o(e),a=o(r),l=o("<div>").addClass("ipnrm-placeholder").css({display:"none"}),c={},d=null,m=null,p=null,u=null,f=[],$=null,h=null,g=!1,v=null;this.init=function(){s.audioPlayer.init(),b(),k()},this.setAudio=function(e){e.enabled&&e.src?(h!==e.src&&(h=e.src,s.audioPlayer.setAudio(e.src),e.loop&&s.audioPlayer.setLoop(e.loop),e.volume&&s.audioPlayer.setVolume(e.volume),e.autoPlay&&s.audioPlayer.play()),c.$audioPlayer.addClass("ipnrm-active")):e.stopPrevious&&(s.audioPlayer.setAudio(),h=null,c.$audioPlayer.removeClass("ipnrm-active"))},this.setCompass=function(e){t.off("ipanorama:scene-camera-change",U),e.cfg.compass&&e.cfg.compass.enabled&&"flat"!=e.cfg.type&&"littleplanet"!=e.cfg.type?(t.on("ipanorama:scene-camera-change",U),c.$compass.toggleClass("ipnrm-active",e.cfg.compass.enabled),C(e)):c.$compass.toggleClass("ipnrm-active",!1)},this.destroy=function(){w(),c.$widget.remove(),c={},a.removeClass("ipnrm-widget-modern"),s.audioPlayer.destroy()};var C=function(e){if(e.control){var n=e.control.getLookAt().yaw,s=e.cfg.compass.northOffset-n;s=(s%=360)<0?s+360:s,c.$compass.css({transform:"rotate("+s+"deg)"})}},b=function(){a.addClass("ipnrm-widget-modern"),c.$widget=o("<div>").addClass("ipnrm-widget"),c.$firstLoad=o("<div>").addClass("ipnrm-first-load"),c.$ts=o("<div>").addClass("ipnrm-ts"),c.$bs=o("<div>").addClass("ipnrm-bs"),c.$tlBar=o("<div>").addClass("ipnrm-tl-bar"),c.$trBar=o("<div>").addClass("ipnrm-tr-bar"),c.$brBar=o("<div>").addClass("ipnrm-br-bar"),c.$blBar=o("<div>").addClass("ipnrm-bl-bar"),c.$progress=o("<div>").addClass("ipnrm-progress"),c.$progressBar=o("<div>").addClass("ipnrm-progress-bar").appendTo(c.$progress),c.$audioPlayer=s.audioPlayer.controls.$widget,c.$prevScene=o("<div>").addClass("ipnrm-btn ipnrm-prev-scene"),c.$nextScene=o("<div>").addClass("ipnrm-btn ipnrm-next-scene"),c.$stereoMode=o("<div>").addClass("ipnrm-btn ipnrm-stereo-mode"),c.$thumbs=o("<div>").addClass("ipnrm-btn ipnrm-thumbs"),c.$compass=o("<div>").addClass("ipnrm-btn ipnrm-compass"),c.$fullscreen=o("<div>").addClass("ipnrm-btn ipnrm-fullscreen"),c.$title=o("<div>").addClass("ipnrm-title"),c.$ts.append(c.$tlBar,c.$trBar),c.$bs.append(c.$blBar,c.$brBar),c.$tlBar.append(c.$audioPlayer),c.$trBar.append(c.$prevScene,c.$nextScene),c.$brBar.append(c.$stereoMode,c.$thumbs,c.$compass,c.$fullscreen),c.$blBar.append(c.$title),c.$thumbsWrap=o("<div>").addClass("ipnrm-thumbs-wrap"),c.$thumbsList=o("<div>").addClass("ipnrm-thumbs-list"),c.$thumbsClose=o("<div>").addClass("ipnrm-thumbs-close"),c.$thumbsWrap.append(c.$thumbsList,c.$thumbsClose),c.$widget.append(c.$progress,c.$firstLoad,c.$ts,c.$bs,c.$thumbsWrap),a.append(c.$widget),y(),t.on("ipanorama:config",W).trigger("ipanorama:config")},k=function(){a.on("ipanorama:ready",j),a.on("fullscreenchange mozfullscreenchange webkitfullscreenchange msfullscreenchange",D),t.on("ipanorama:scene-before-load",q),t.on("ipanorama:scene-after-load",E),t.on("ipanorama:scene-progress",R),t.on("ipanorama:scene-error",N),t.on("ipanorama:scene-hide-start",O),t.on("ipanorama:scene-hide-complete",I),t.on("ipanorama:scene-show-start",H),t.on("ipanorama:scene-show-complete",_),t.on("ipanorama:scene-index",V),t.on("ipanorama:mode",z),c.$prevScene.on("click",S),c.$nextScene.on("click",x),c.$stereoMode.on("click",L),c.$compass.on("click",A),c.$fullscreen.on("click",M),c.$thumbs.on("click",F),c.$thumbsList.on("click",".ipnrm-thumb",P),c.$thumbsClose.on("click",B),c.$firstLoad.on("click",T)},w=function(){a.off("ipanorama:ready",j),a.off("fullscreenchange mozfullscreenchange webkitfullscreenchange msfullscreenchange",D),t.off("ipanorama:scene-before-load",q),t.off("ipanorama:scene-after-load",E),t.off("ipanorama:scene-progress",R),t.off("ipanorama:scene-error",N),t.off("ipanorama:scene-hide-start",O),t.off("ipanorama:scene-hide-complete",I),t.off("ipanorama:scene-show-start",H),t.off("ipanorama:scene-show-complete",_),t.off("ipanorama:scene-camera-change",U),t.off("ipanorama:scene-index",V),t.off("ipanorama:mode",z),c.$prevScene.off("click",S),c.$nextScene.off("click",x),c.$stereoMode.off("click",L),c.$compass.off("click",A),c.$fullscreen.off("click",M),c.$thumbs.off("click",F),c.$thumbsList.off("click",".ipnrm-thumb",P),c.$thumbsClose.off("click",B),c.$firstLoad.off("click",T)},y=function(){c.$firstLoad.addClass("ipnrm-hide"),c.$title.addClass("ipnrm-hide"),c.$audioPlayer.addClass("ipnrm-hide"),c.$compass.addClass("ipnrm-hide"),c.$prevScene.addClass("ipnrm-hide"),c.$nextScene.addClass("ipnrm-hide"),c.$fullscreen.addClass("ipnrm-hide"),c.$thumbs.addClass("ipnrm-hide"),c.$stereoMode.addClass("ipnrm-hide"),c.$thumbsWrap.addClass("ipnrm-hide")},S=function(e){($-=1)<0?$=null:t.trigger("ipanorama:set-scene",{id:f[$]})},x=function(e){($+=1)>=f.length?($=f.length-1,t.trigger("ipanorama:next-scene")):t.trigger("ipanorama:set-scene",{id:f[$]})},L=function(e){var n=d;switch(n){case"normal":n="stereo";break;case"stereo":n="normal"}t.trigger("ipanorama:mode",{mode:n})},F=function(e){var n=c.$thumbsList.find(".ipnrm-thumb.ipnrm-active");n.removeClass("ipnrm-active"),(n=c.$thumbsList.find('[data-scene-id="'+m+'"]')).addClass("ipnrm-active"),c.$thumbsWrap.addClass("ipnrm-active"),setTimeout(function(){if(c.$thumbsList.find(".ipnrm-thumb").length){var e=c.$thumbsList.find(".ipnrm-thumb:first-child").get(0).offsetTop;c.$thumbsList.get(0).scrollTop=n.get(0).offsetTop-e}},100)},P=function(e){t.trigger("ipanorama:set-scene",{id:o(this).data("scene-id")}),c.$thumbsWrap.removeClass("ipnrm-active")},B=function(e){c.$thumbsWrap.removeClass("ipnrm-active")},A=function(e){if(p){var n=p.control.getLookAt();p.control.lookAt({yaw:p.cfg.compass.northOffset,pitch:n.pitch},600)}},M=function(e){if(document.fullscreenEnabled||document.webkitFullscreenEnabled)if(c.$fullscreen.hasClass("ipnrm-active"))try{document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()}catch(e){}else try{var n=a.get(0);n.requestFullscreen?n.requestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.webkitRequestFullscreen?n.webkitRequestFullscreen():n.msRequestFullscreen&&n.msRequestFullscreen()}catch(e){}else a.toggleClass("ipnrm-fullscreen-mode"),a.hasClass("ipnrm-fullscreen-mode")?(c.$fullscreen.addClass("ipnrm-active"),l.insertBefore(a),a.detach(),o("body").append(a)):(c.$fullscreen.removeClass("ipnrm-active"),a.detach(),a.insertAfter(l),l.remove()),v._onWindowResize()},T=function(e){u&&(c.$firstLoad.addClass("ipnrm-hide"),t.trigger("ipanorama:set-scene",{id:u}))},W=function(e,n){if(n&&n.config){if(t.off("ipanorama:config",W),!n.config.autoLoad&&0<n.config.scenes.length){c.$firstLoad.removeClass("ipnrm-hide");var s=n.config.scenes[0],a=o(r).data("scene-id");if(a)for(var i=0;i<n.config.scenes.length;i++)if(n.config.scenes[i].id===a){s=n.config.scenes[i];break}u=s.id}!function(e){for(var n=0;n<e.scenes.length;n++){var s=e.scenes[n];if(s.image||s.imageThumb){var a=o("<div>").addClass("ipnrm-thumb").attr({"data-scene-id":s.id}),i=o("<img>").attr({loading:"lazy",src:s.imageThumb?s.imageThumb:s.image});c.$thumbsList.append(a.append(i))}}}(n.config)}},z=function(e,n){if(n&&n.master)switch(d=n.mode){case"normal":c.$stereoMode.removeClass("ipnrm-active");break;case"stereo":c.$stereoMode.addClass("ipnrm-active")}},R=function(e,n){n.progress.loaded<n.progress.total?(g||(c.$progress.addClass("ipnrm-active"),g=!0),c.$progressBar.css({width:n.progress.loaded/n.progress.total*100+"%"})):(g&&(c.$progress.removeClass("ipnrm-active"),g=!1),c.$progressBar.css({width:0}))},q=function(e,n){p=n.scene},E=function(e,n){c.$progress.removeClass("ipnrm-active"),g=!1,c.$firstLoad.addClass("ipnrm-hide"),i.titleControl&&c.$title.removeClass("ipnrm-hide"),i.audioControl&&c.$audioPlayer.removeClass("ipnrm-hide"),i.compassControl&&c.$compass.removeClass("ipnrm-hide"),i.prevSceneControl&&c.$prevScene.removeClass("ipnrm-hide"),i.nextSceneControl&&c.$nextScene.removeClass("ipnrm-hide"),i.fullscreenControl&&c.$fullscreen.removeClass("ipnrm-hide"),i.thumbnailControl&&c.$thumbs.removeClass("ipnrm-hide"),i.viewerModeControl&&c.$stereoMode.removeClass("ipnrm-hide"),c.$thumbsWrap.removeClass("ipnrm-hide")},N=function(e,n){c.$progress.removeClass("ipnrm-active"),g=!1,y()},O=function(e,n){},I=function(e,n){},H=function(e,n){s.setAudio(n.scene.cfg.audio),s.setCompass(n.scene),n.scene.cfg.title?(c.$title.get(0).innerHTML=n.scene.cfg.title,c.$title.addClass("ipnrm-active")):(c.$title.get(0).innerHTML=null,c.$title.removeClass("ipnrm-active"))},_=function(e,n){},U=function(e,n){n.scene&&C(n.scene)},V=function(e,n){if(n)if(m=n.scene.cfg.id,null==$?(f.push(m),$=0):f[$]!=m&&($+=1,(f=f.slice(0,$)).push(m)),0<$?c.$prevScene.addClass("ipnrm-active"):c.$prevScene.removeClass("ipnrm-active"),$<f.length-1)c.$nextScene.addClass("ipnrm-active");else if(c.$nextScene.removeClass("ipnrm-active"),i.moveToNextScene){for(var s=0;s<n.config.scenes.length;s++){var a=n.config.scenes[s];if(a.id==m)break}s<n.config.scenes.length-1&&c.$nextScene.addClass("ipnrm-active")}},j=function(e,n){v=n.instance},D=function(e){document.fullscreen||document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement?c.$fullscreen.addClass("ipnrm-active"):c.$fullscreen.removeClass("ipnrm-active"),setTimeout(function(){v._onWindowResize()},100)}}};G.Widget=G.Widget||{},G.Widget.Modern=e})((e=e||self).IPANORAMA=e.IPANORAMA||{})}(this);