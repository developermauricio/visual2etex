!function(e,n){(function(B){"use strict";var e={name:"list",defaultConfig:{titleControl:!0,prevSceneControl:!0,nextSceneControl:!0,audioControl:!0,compassControl:!0,fullscreenControl:!0,sceneListControl:!0,moveToNextScene:!0},widget:function(e,t,a,n){n&&(a=B.Utils.extend(n,a)),this.audioPlayer=new B.AudioPlayer;var s=this,o=B.$,c=o(e),i=o(t),r=o("<div>").addClass("ipnrm-placeholder").css({display:"none"}),l={},d=null,m=null,p=null,f=[],u=null,v=null,$=!1,g=null;this.init=function(){s.audioPlayer.init(),h(),L()},this.setAudio=function(e){e.enabled&&e.src?(v!==e.src&&(v=e.src,s.audioPlayer.setAudio(e.src),e.loop&&s.audioPlayer.setLoop(e.loop),e.volume&&s.audioPlayer.setVolume(e.volume),e.autoPlay&&s.audioPlayer.play()),l.$audioPlayer.addClass("ipnrm-active")):e.stopPrevious&&(s.audioPlayer.setAudio(),v=null,l.$audioPlayer.removeClass("ipnrm-active"))},this.setCompass=function(e){c.off("ipanorama:scene-camera-change",M),e.cfg.compass&&e.cfg.compass.enabled&&"flat"!=e.cfg.type&&"littleplanet"!=e.cfg.type?(c.on("ipanorama:scene-camera-change",M),l.$compass.toggleClass("ipnrm-active",e.cfg.compass.enabled),C(e)):l.$compass.toggleClass("ipnrm-active",!1)},this.destroy=function(){y(),l.$widget.remove(),l={},i.removeClass("ipnrm-widget-list"),s.audioPlayer.destroy()};var C=function(e){if(e.control){var n=e.control.getLookAt().yaw,s=e.cfg.compass.northOffset-n;s=(s%=360)<0?s+360:s,l.$compass.css({transform:"rotate("+s+"deg)"})}},h=function(){i.addClass("ipnrm-widget-list"),l.$widget=o("<div>").addClass("ipnrm-widget"),l.$firstLoad=o("<div>").addClass("ipnrm-first-load"),l.$progress=o("<div>").addClass("ipnrm-progress"),l.$navigation=o("<div>").addClass("ipnrm-navigation"),l.$prevScene=o("<div>").addClass("ipnrm-btn ipnrm-prev-scene"),l.$nextScene=o("<div>").addClass("ipnrm-btn ipnrm-next-scene"),l.$sceneListHead=o("<div>").addClass("ipnrm-scene-list-head"),l.$sceneListData=o("<div>").addClass("ipnrm-scene-list-data"),l.$sceneList=o("<div>").addClass("ipnrm-btn ipnrm-scene-list").append("<div><div></div><div></div><div></div></div>"),l.$audioPlayer=s.audioPlayer.controls.$widget,l.$title=o("<div>").addClass("ipnrm-title"),l.$tools=o("<div>").addClass("ipnrm-tools"),l.$compass=o("<div>").addClass("ipnrm-btn ipnrm-compass"),l.$fullscreen=o("<div>").addClass("ipnrm-btn ipnrm-fullscreen"),l.$navigation.append(l.$prevScene,l.$nextScene),l.$tools.append(l.$compass,l.$fullscreen),l.$widget.append(l.$progress,l.$firstLoad,l.$navigation,l.$sceneListHead,l.$sceneListData,l.$sceneList,l.$audioPlayer,l.$title,l.$tools),i.append(l.$widget),S(),c.on("ipanorama:config",D).trigger("ipanorama:config")},L=function(){i.on("ipanorama:ready",I),i.on("fullscreenchange mozfullscreenchange webkitfullscreenchange msfullscreenchange",_),c.on("ipanorama:scene-before-load",z),c.on("ipanorama:scene-after-load",H),c.on("ipanorama:scene-progress",R),c.on("ipanorama:scene-error",q),c.on("ipanorama:scene-hide-start",E),c.on("ipanorama:scene-hide-complete",T),c.on("ipanorama:scene-show-start",W),c.on("ipanorama:scene-show-complete",N),c.on("ipanorama:scene-index",O),l.$firstLoad.on("click",A),l.$prevScene.on("click",k),l.$nextScene.on("click",w),l.$sceneList.on("click",x),l.$sceneListData.on("click",".ipnrm-scene-list-item",b),l.$compass.on("click",F),l.$fullscreen.on("click",P)},y=function(){i.off("ipanorama:ready",I),i.off("fullscreenchange mozfullscreenchange webkitfullscreenchange msfullscreenchange",_),c.off("ipanorama:scene-before-load",z),c.off("ipanorama:scene-after-load",H),c.off("ipanorama:scene-progress",R),c.off("ipanorama:scene-error",q),c.off("ipanorama:scene-hide-start",E),c.off("ipanorama:scene-hide-complete",T),c.off("ipanorama:scene-show-start",W),c.off("ipanorama:scene-show-complete",N),c.off("ipanorama:scene-camera-change",M),c.off("ipanorama:scene-index",O),l.$firstLoad.off("click",A),l.$prevScene.off("click",k),l.$nextScene.off("click",w),l.$sceneList.off("click",x),l.$sceneListData.off("click",b),l.$compass.off("click",F),l.$fullscreen.off("click",P)},S=function(){l.$firstLoad.addClass("ipnrm-hide"),l.$prevScene.addClass("ipnrm-hide"),l.$nextScene.addClass("ipnrm-hide"),l.$compass.addClass("ipnrm-hide"),l.$sceneList.addClass("ipnrm-hide"),l.$sceneListHead.addClass("ipnrm-hide"),l.$sceneListData.addClass("ipnrm-hide"),l.$audioPlayer.addClass("ipnrm-hide"),l.$title.addClass("ipnrm-hide"),l.$fullscreen.addClass("ipnrm-hide")},k=function(e){(u-=1)<0?u=null:c.trigger("ipanorama:set-scene",{id:f[u]})},w=function(e){(u+=1)>=f.length?(u=f.length-1,c.trigger("ipanorama:next-scene")):c.trigger("ipanorama:set-scene",{id:f[u]})},x=function(e){l.$sceneList.hasClass("ipnrm-active")?(l.$sceneListHead.css({transition:"all .2s linear .2s"}),l.$sceneListData.css({transition:"all .2s linear"})):(l.$sceneListHead.css({transition:"all .2s linear"}),l.$sceneListData.css({transition:"all .2s linear .2s"})),l.$sceneList.toggleClass("ipnrm-active"),l.$sceneListHead.toggleClass("ipnrm-active"),l.$sceneListData.toggleClass("ipnrm-active")},b=function(e){var n=o(this);d=n.data("scene-id"),c.trigger("ipanorama:set-scene",{id:d})},F=function(e){if(m){var n=m.control.getLookAt();m.control.lookAt({yaw:m.cfg.compass.northOffset,pitch:n.pitch},600)}},P=function(e){if(document.fullscreenEnabled||document.webkitFullscreenEnabled)if(l.$fullscreen.hasClass("ipnrm-active"))try{document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()}catch(e){}else try{var n=i.get(0);n.requestFullscreen?n.requestFullscreen():n.mozRequestFullScreen?n.mozRequestFullScreen():n.webkitRequestFullscreen?n.webkitRequestFullscreen():n.msRequestFullscreen&&n.msRequestFullscreen()}catch(e){}else i.toggleClass("ipnrm-fullscreen-mode"),i.hasClass("ipnrm-fullscreen-mode")?(l.$fullscreen.addClass("ipnrm-active"),r.insertBefore(i),i.detach(),o("body").append(i)):(l.$fullscreen.removeClass("ipnrm-active"),i.detach(),i.insertAfter(r),r.remove()),g._onWindowResize()},A=function(e){p&&(l.$firstLoad.addClass("ipnrm-hide"),c.trigger("ipanorama:set-scene",{id:p}))},D=function(e,n){if(n&&n.config){if(c.off("ipanorama:config",D),!n.config.autoLoad&&0<n.config.scenes.length){l.$firstLoad.removeClass("ipnrm-hide");var s=n.config.scenes[0],i=o(t).data("scene-id");if(i)for(var a=0;a<n.config.scenes.length;a++)if(n.config.scenes[a].id===i){s=n.config.scenes[a];break}p=s.id}!function(e){for(var n=0;n<e.scenes.length;n++){var s=e.scenes[n];if(s.title){var i=o("<div>").addClass("ipnrm-scene-list-item").attr({"data-scene-id":s.id}).html(s.title);l.$sceneListData.append(i)}}}(n.config)}},R=function(e,n){n.progress.loaded<n.progress.total?$||(l.$progress.addClass("ipnrm-active"),$=!0):$&&(l.$progress.removeClass("ipnrm-active"),$=!1)},z=function(e,n){m=n.scene},H=function(e,n){l.$progress.removeClass("ipnrm-active"),$=!1;var s=n.scene.cfg.id;l.$sceneListData.find(".ipnrm-scene-list-item").removeClass("ipnrm-active"),l.$sceneListData.find('.ipnrm-scene-list-item[data-scene-id="'+s+'"]').addClass("ipnrm-active"),l.$firstLoad.addClass("ipnrm-hide"),a.prevSceneControl&&l.$prevScene.removeClass("ipnrm-hide"),a.nextSceneControl&&l.$nextScene.removeClass("ipnrm-hide"),a.compassControl&&l.$compass.removeClass("ipnrm-hide"),a.sceneListControl&&l.$sceneList.removeClass("ipnrm-hide"),a.sceneListControl&&l.$sceneListHead.removeClass("ipnrm-hide"),a.sceneListControl&&l.$sceneListData.removeClass("ipnrm-hide"),a.audioControl&&l.$audioPlayer.removeClass("ipnrm-hide"),a.titleControl&&l.$title.removeClass("ipnrm-hide"),a.fullscreenControl&&l.$fullscreen.removeClass("ipnrm-hide")},q=function(e,n){l.$progress.removeClass("ipnrm-active"),$=!1,S()},E=function(e,n){},T=function(e,n){},W=function(e,n){s.setAudio(n.scene.cfg.audio),s.setCompass(n.scene),n.scene.cfg.title?(l.$title.get(0).innerHTML=n.scene.cfg.title,l.$title.addClass("ipnrm-active")):(l.$title.get(0).innerHTML=null,l.$title.removeClass("ipnrm-active"))},M=function(e,n){n.scene&&C(n.scene)},N=function(e,n){},O=function(e,n){if(n)if(d=n.scene.cfg.id,null==u?(f.push(d),u=0):f[u]!=d&&(u+=1,(f=f.slice(0,u)).push(d)),0<u?l.$prevScene.addClass("ipnrm-active"):l.$prevScene.removeClass("ipnrm-active"),u<f.length-1)l.$nextScene.addClass("ipnrm-active");else if(l.$nextScene.removeClass("ipnrm-active"),a.moveToNextScene){for(var s=0;s<n.config.scenes.length;s++){var i=n.config.scenes[s];if(i.id==d)break}s<n.config.scenes.length-1&&l.$nextScene.addClass("ipnrm-active")}},I=function(e,n){g=n.instance},_=function(e){document.fullscreen||document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement?l.$fullscreen.addClass("ipnrm-active"):l.$fullscreen.removeClass("ipnrm-active"),setTimeout(function(){g._onWindowResize()},100)}}};B.Widget=B.Widget||{},B.Widget.List=e})((e=e||self).IPANORAMA=e.IPANORAMA||{})}(this);