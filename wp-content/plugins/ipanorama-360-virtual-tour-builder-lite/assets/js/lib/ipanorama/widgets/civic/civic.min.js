!function(e,o){(function(ee){"use strict";var e={name:"civic",defaultConfig:{audioControl:!0,compassControl:!0,titleThumbnails:!0,thumbnailsControl:!0,prevSceneControl:!0,nextSceneControl:!0,zoomInControl:!0,zoomOutControl:!0,lookUpControl:!0,lookDownControl:!0,lookLeftControl:!0,lookRightControl:!0,homeControl:!1,fullscreenControl:!0,viewerModeControl:!1,toogleInterfaceControl:!0,startFullscreen:!1,hideInterface:!1},widget:function(e,s,r,o){o&&(r=ee.Utils.extend(o,r)),this.audioPlayer=new ee.AudioPlayer;var n=this,a=ee.$,c=a(e),i=a(s),t=a("<div>").addClass("ipnrm-placeholder").css({display:"none"}),l={},m=null,d=null,f=null,u=null,p=!1,v=null,g=null;this.init=function(){n.audioPlayer.init(),$(),C()},this.setAudio=function(e){e.enabled&&e.src?(u!==e.src&&(u=e.src,n.audioPlayer.setAudio(e.src),e.loop&&n.audioPlayer.setLoop(e.loop),e.volume&&n.audioPlayer.setVolume(e.volume),e.autoPlay&&n.audioPlayer.play()),l.$audioPlayer.addClass("ipnrm-active")):e.stopPrevious&&(n.audioPlayer.setAudio(),u=null,l.$audioPlayer.removeClass("ipnrm-active"))},this.setCompass=function(e){c.off("ipanorama:scene-camera-change",R),e.cfg.compass&&e.cfg.compass.enabled&&"flat"!=e.cfg.type&&"littleplanet"!=e.cfg.type?(c.on("ipanorama:scene-camera-change",R),l.$compass.toggleClass("ipnrm-active",e.cfg.compass.enabled),h(e)):l.$compass.toggleClass("ipnrm-active",!1)},this.destroy=function(){w(),l.$widget.remove(),l={},i.removeClass("ipnrm-widget-civic"),n.audioPlayer.destroy()};var h=function(e){if(e.control){var o=e.control.getLookAt().yaw,n=e.cfg.compass.northOffset-o;n=(n%=360)<0?n+360:n,l.$compass.css({transform:"rotate("+n+"deg)"})}},$=function(){i.addClass("ipnrm-widget-civic"),l.$widget=a("<div>").addClass("ipnrm-widget"),l.$firstLoad=a("<div>").addClass("ipnrm-first-load"),l.$progress=a("<div>").addClass("ipnrm-progress"),l.$progressBar=a("<div>").addClass("ipnrm-progress-bar").appendTo(l.$progress),l.$interface=a("<div>").addClass("ipnrm-interface"),l.$audioPlayer=n.audioPlayer.controls.$widget,l.$compass=a("<div>").addClass("ipnrm-compass"),l.$thumbsBar=a("<div>").addClass("ipnrm-thumbs-bar"),l.$menuBar=a("<div>").addClass("ipnrm-menu-bar"),l.$interface.append(l.$thumbsBar,l.$menuBar),l.$prevScene=a("<div>").addClass("ipnrm-btn ipnrm-prev-scene"),l.$nextScene=a("<div>").addClass("ipnrm-btn ipnrm-next-scene"),l.$zoomIn=a("<div>").addClass("ipnrm-btn ipnrm-zoom-in"),l.$zoomOut=a("<div>").addClass("ipnrm-btn ipnrm-zoom-out"),l.$lookUp=a("<div>").addClass("ipnrm-btn ipnrm-look-up"),l.$lookDown=a("<div>").addClass("ipnrm-btn ipnrm-look-down"),l.$lookLeft=a("<div>").addClass("ipnrm-btn ipnrm-look-left"),l.$lookRight=a("<div>").addClass("ipnrm-btn ipnrm-look-right"),l.$home=a("<div>").addClass("ipnrm-btn ipnrm-home"),l.$fullscreen=a("<div>").addClass("ipnrm-btn ipnrm-fullscreen"),l.$vr=a("<div>").addClass("ipnrm-btn ipnrm-vr"),l.$toggleInterface=a("<div>").addClass("ipnrm-btn ipnrm-toggle-interface"),l.$menuBar.append(l.$prevScene,l.$nextScene,l.$zoomIn,l.$zoomOut,l.$lookUp,l.$lookDown,l.$lookLeft,l.$lookRight,l.$home,l.$fullscreen,l.$vr,l.$toggleInterface),l.$widget.append(l.$progress,l.$firstLoad,l.$audioPlayer,l.$compass,l.$interface),i.append(l.$widget),r.startFullscreen&&i.addClass("ipnrm-fullscreen"),r.hideInterface&&l.$widget.addClass("ipnrm-hide-controls"),b(),c.on("ipanorama:config",U).trigger("ipanorama:config")},C=function(){i.on("ipanorama:ready",x),i.on("mouseup touchend",M),i.on("fullscreenchange mozfullscreenchange webkitfullscreenchange msfullscreenchange",Y),c.on("ipanorama:scene-before-load",S),c.on("ipanorama:scene-after-load",T),c.on("ipanorama:scene-progress",F),c.on("ipanorama:scene-error",P),c.on("ipanorama:scene-show-start",B),c.on("ipanorama:mode",O),l.$thumbsBar.on("click",".ipnrm-thumb",q),l.$firstLoad.on("click",D),l.$prevScene.on("click",E),l.$nextScene.on("click",W),l.$zoomIn.on("mousedown touchstart",Z),l.$zoomOut.on("mousedown touchstart",N),l.$lookUp.on("mousedown touchstart",_),l.$lookDown.on("mousedown touchstart",V),l.$lookLeft.on("mousedown touchstart",j),l.$lookRight.on("mousedown touchstart",G),l.$home.on("click",H),l.$fullscreen.on("click",J),l.$vr.on("click",K),l.$compass.on("click",X),l.$toggleInterface.on("click",Q)},w=function(){i.off("ipanorama:ready",x),i.off("mouseup  touchend",M),i.off("fullscreenchange mozfullscreenchange webkitfullscreenchange msfullscreenchange",Y),c.off("ipanorama:scene-before-load",S),c.off("ipanorama:scene-after-load",T),c.off("ipanorama:scene-progress",F),c.off("ipanorama:scene-error",P),c.off("ipanorama:scene-show-start",B),c.off("ipanorama:scene-camera-change",R),c.off("ipanorama:mode",O),l.$thumbsBar.off("click",".ipnrm-thumb",q),l.$firstLoad.off("click",D),l.$prevScene.off("click",E),l.$nextScene.off("click",W),l.$zoomIn.off("mousedown touchstart",Z),l.$zoomOut.off("mousedown touchstart",N),l.$lookUp.off("mousedown touchstart",_),l.$lookDown.off("mousedown touchstart",V),l.$lookLeft.off("mousedown touchstart",j),l.$lookRight.off("mousedown touchstart",G),l.$home.off("click",H),l.$fullscreen.off("click",J),l.$vr.off("click",K),l.$compass.off("click",X),l.$toggleInterface.off("click",Q)},b=function(){l.$firstLoad.addClass("ipnrm-hide"),l.$audioPlayer.addClass("ipnrm-hide"),l.$compass.addClass("ipnrm-hide"),l.$thumbsBar.addClass("ipnrm-hide"),l.$prevScene.addClass("ipnrm-hide"),l.$nextScene.addClass("ipnrm-hide"),l.$zoomIn.addClass("ipnrm-hide"),l.$zoomOut.addClass("ipnrm-hide"),l.$lookUp.addClass("ipnrm-hide"),l.$lookDown.addClass("ipnrm-hide"),l.$lookLeft.addClass("ipnrm-hide"),l.$lookRight.addClass("ipnrm-hide"),l.$home.addClass("ipnrm-hide"),l.$fullscreen.addClass("ipnrm-hide"),l.$vr.addClass("ipnrm-hide"),l.$toggleInterface.addClass("ipnrm-hide")},k=function(){v=setTimeout(function(){var e=g.viewer.sceneActive.control,o=e.getZoom();"flat"==g.viewer.sceneActive.cfg.type?o+=.01:"littleplanet"==g.viewer.sceneActive.cfg.type?o-=50:o-=.2,e.setZoom(o),k()},10)},y=function(){v=setTimeout(function(){var e=g.viewer.sceneActive.control,o=e.getZoom();"flat"==g.viewer.sceneActive.cfg.type?o-=.01:"littleplanet"==g.viewer.sceneActive.cfg.type?o+=50:o+=.2,e.setZoom(o),y()},10)},A=function(){v=setTimeout(function(){var e=g.viewer.sceneActive.control;"flat"==g.viewer.sceneActive.cfg.type?e.rotateUp(5):e.rotateUp(.01),A()},10)},z=function(){v=setTimeout(function(){var e=g.viewer.sceneActive.control;"flat"==g.viewer.sceneActive.cfg.type?e.rotateUp(-5):e.rotateUp(-.01),z()},10)},L=function(){v=setTimeout(function(){var e=g.viewer.sceneActive.control;"flat"==g.viewer.sceneActive.cfg.type?e.rotateLeft(5):e.rotateLeft(.01),L()},10)},I=function(){v=setTimeout(function(){var e=g.viewer.sceneActive.control;"flat"==g.viewer.sceneActive.cfg.type?e.rotateLeft(-5):e.rotateLeft(-.01),I()},10)},F=function(e,o){o.progress.loaded<o.progress.total?(p||(l.$progress.addClass("ipnrm-active"),p=!0),l.$progressBar.css({width:o.progress.loaded/o.progress.total*100+"%"})):(p&&(l.$progress.removeClass("ipnrm-active"),p=!1),l.$progressBar.css({width:0}))},S=function(e,o){f=o.scene},T=function(e,o){l.$progress.removeClass("ipnrm-active"),p=!1;var n=l.$thumbsBar.find('.ipnrm-thumb[data-scene-id="'+o.scene.cfg.id+'"]');l.$thumbsBar.find(".ipnrm-thumb.ipnrm-active").removeClass("ipnrm-active"),n.addClass("ipnrm-active"),function(){l.$firstLoad.addClass("ipnrm-hide"),r.audioControl&&l.$audioPlayer.removeClass("ipnrm-hide"),r.compassControl&&l.$compass.removeClass("ipnrm-hide"),r.thumbnailsControl&&l.$thumbsBar.removeClass("ipnrm-hide"),r.prevSceneControl&&l.$prevScene.removeClass("ipnrm-hide"),r.nextSceneControl&&l.$nextScene.removeClass("ipnrm-hide"),r.zoomInControl&&l.$zoomIn.removeClass("ipnrm-hide"),r.zoomOutControl&&l.$zoomOut.removeClass("ipnrm-hide"),r.lookUpControl&&l.$lookUp.removeClass("ipnrm-hide"),r.lookDownControl&&l.$lookDown.removeClass("ipnrm-hide"),r.lookLeftControl&&l.$lookLeft.removeClass("ipnrm-hide"),r.lookRightControl&&l.$lookRight.removeClass("ipnrm-hide"),r.homeControl&&l.$home.removeClass("ipnrm-hide"),r.fullscreenControl&&l.$fullscreen.removeClass("ipnrm-hide"),r.viewerModeControl&&l.$vr.removeClass("ipnrm-hide"),r.toogleInterfaceControl&&l.$toggleInterface.removeClass("ipnrm-hide"),i.hasClass("ipnrm-fullscreen")?l.$fullscreen.addClass("ipnrm-active"):l.$fullscreen.removeClass("ipnrm-active");l.$widget.hasClass("ipnrm-hide-controls")?l.$toggleInterface.removeClass("ipnrm-active"):l.$toggleInterface.addClass("ipnrm-active")}(),setTimeout(function(){if(l.$thumbs.find(".ipnrm-thumb").length){var e=l.$thumbs.find(".ipnrm-thumb:first-child").get(0).offsetLeft;l.$thumbsBar.get(0).scrollLeft=n.get(0).offsetLeft-e}},100)},P=function(e,o){l.$progress.removeClass("ipnrm-active"),p=!1,b()},B=function(e,o){n.setAudio(o.scene.cfg.audio),n.setCompass(o.scene)},R=function(e,o){o.scene&&h(o.scene)},x=function(e,o){g=o.instance},U=function(e,o){if(o&&o.config){if(c.off("ipanorama:config",U),!o.config.autoLoad&&0<o.config.scenes.length){l.$firstLoad.removeClass("ipnrm-hide");var n=o.config.scenes[0],i=a(s).data("scene-id");if(i)for(var t=0;t<o.config.scenes.length;t++)if(o.config.scenes[t].id===i){n=o.config.scenes[t];break}d=n.id}!function(e){if(!e.scenes.length)return;l.$thumbs=a("<div>").addClass("ipnrm-thumbs"),l.$thumbsBar.append(l.$thumbs);for(var o=0;o<e.scenes.length;o++){var n=e.scenes[o],i=a("<div>").addClass("ipnrm-thumb").attr({"data-scene-id":n.id});if(r.titleThumbnails){if(n.title){var t=a("<div>").addClass("ipnrm-thumb-title").html(n.title);l.$thumbs.append(i.append(t))}}else if(n.image||n.imageThumb){var s=a("<img>").attr({loading:"lazy",src:n.imageThumb?n.imageThumb:n.image});l.$thumbs.append(i.append(s));var t=a("<div>").addClass("ipnrm-thumb-title-img").html(n.title);l.$thumbs.append(i.append(t))}}}(o.config)}},O=function(e,o){if(o&&o.master)switch(m=o.mode){case"normal":l.$vr.removeClass("ipnrm-active");break;case"stereo":l.$vr.addClass("ipnrm-active")}},q=function(e){c.trigger("ipanorama:set-scene",{id:a(this).data("scene-id")}),l.$thumbsBar.find(".ipnrm-thumb.ipnrm-active").removeClass("ipnrm-active"),a(this).addClass("ipnrm-active")},D=function(e){d&&(l.$firstLoad.addClass("ipnrm-hide"),c.trigger("ipanorama:set-scene",{id:d}))},E=function(e){if(g.viewer&&g.viewer.sceneActive){for(var o=g.viewer.sceneActive.cfg.id,n=0;n<g.config.scenes.length;n++){var i=g.config.scenes[n];if(i.id==o)break}n-1<0?n=g.config.scenes.length-1:n-=1,c.trigger("ipanorama:set-scene",{id:g.config.scenes[n].id})}},W=function(e){if(g.viewer&&g.viewer.sceneActive){for(var o=g.viewer.sceneActive.cfg.id,n=0;n<g.config.scenes.length;n++){var i=g.config.scenes[n];if(i.id==o)break}n+1>=g.config.scenes.length?n=0:n+=1,c.trigger("ipanorama:set-scene",{id:g.config.scenes[n].id})}},M=function(e){clearTimeout(v)},Z=function(e){clearTimeout(v),k()},N=function(e){clearTimeout(v),y()},_=function(e){clearTimeout(v),A()},V=function(e){clearTimeout(v),z()},j=function(e){clearTimeout(v),L()},G=function(e){clearTimeout(v),I()},H=function(e){var o=g.viewer.sceneActive.control;o.lookAt(g.viewer.sceneActive.cfg.camera.lookAt,500)},J=function(e){if(document.fullscreenEnabled||document.webkitFullscreenEnabled)if(l.$fullscreen.hasClass("ipnrm-active"))try{document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()}catch(e){}else try{var o=i.get(0);o.requestFullscreen?o.requestFullscreen():o.mozRequestFullScreen?o.mozRequestFullScreen():o.webkitRequestFullscreen?o.webkitRequestFullscreen():o.msRequestFullscreen&&o.msRequestFullscreen()}catch(e){}else i.toggleClass("ipnrm-fullscreen-mode"),i.hasClass("ipnrm-fullscreen-mode")?(l.$fullscreen.addClass("ipnrm-active"),t.insertBefore(i),i.detach(),a("body").append(i)):(l.$fullscreen.removeClass("ipnrm-active"),i.detach(),i.insertAfter(t),t.remove()),g._onWindowResize()},K=function(e){var o=m;switch(o){case"normal":o="stereo";break;case"stereo":o="normal"}c.trigger("ipanorama:mode",{mode:o})},Q=function(e){l.$widget.toggleClass("ipnrm-hide-controls"),l.$widget.hasClass("ipnrm-hide-controls")?l.$toggleInterface.removeClass("ipnrm-active"):l.$toggleInterface.addClass("ipnrm-active")},X=function(e){if(f){var o=f.control.getLookAt();f.control.lookAt({yaw:f.cfg.compass.northOffset,pitch:o.pitch},600)}},Y=function(e){document.fullscreen||document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement?l.$fullscreen.addClass("ipnrm-active"):l.$fullscreen.removeClass("ipnrm-active"),setTimeout(function(){g._onWindowResize()},100)}}};ee.Widget=ee.Widget||{},ee.Widget.Civic=e})((e=e||self).IPANORAMA=e.IPANORAMA||{})}(this);